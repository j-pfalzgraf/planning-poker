# 13 ストーリーポイント – 大規模な変更

> **工数:** 3〜5日
> **リスク:** 高
> **テスト:** 完全なテストカバレッジが必要
> **複雑さ:** 高

---

## 📋 例 1: マルチステップオンボーディングウィザード

### エピック

> **新規顧客**として、**セットアッププロセスを案内してほしい**。そうすることで、**できるだけ早くシステムを生産的に使用できます**。

### 背景

新規顧客は現在、すべての設定を手動で見つける必要があります。4ステップのウィザードで最も重要なステップを案内し、価値を得るまでの時間を短縮します。

### ウィザードフロー

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   ステップ 1  │───▶│   ステップ 2  │───▶│   ステップ 3  │───▶│   ステップ 4  │
│    会社     │    │   連絡先    │    │   支払い    │    │   確認     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │
      ▼                  ▼                  ▼                  ▼
  バリデーション       バリデーション       バリデーション         送信
    保存               保存               保存             全データ
```

### ステップ詳細

| ステップ      | フィールド                     | バリデーション          |
| ------------- | ------------------------------ | ----------------------- |
| 1. 会社データ | 名前、住所、税ID               | 必須、税IDフォーマット  |
| 2. 連絡担当者 | 名前、メール、電話番号         | メール形式、必須        |
| 3. 支払い方法 | 銀行振込またはクレジットカード | 口座/カード番号チェック |
| 4. 確認       | 全データ（読み取り専用）       | 確認                    |

### 技術コンポーネント

```typescript
// 状態管理
interface OnboardingState {
  currentStep: 1 | 2 | 3 | 4;
  company: CompanyData | null;
  contact: ContactData | null;
  payment: PaymentData | null;
  isDirty: boolean;
  errors: Record<string, string[]>;
}

// 中間保存
const STORAGE_KEY = 'onboarding_draft';
localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
```

### 受け入れ基準

- [ ] 進捗インジケータで現在のステップを表示（1/4、2/4、...）
- [ ] 「次へ」クリック時に各ステップでバリデーション
- [ ] データを失わずに戻るナビゲーション
- [ ] 30秒ごとおよびブラー時にLocalStorageへ自動保存
- [ ] 未保存データがある場合にページを離れる警告
- [ ] 各ステップへの編集リンク付き最終確認
- [ ] 送信時のエラーハンドリング（リトライロジック）
- [ ] モバイル最適化（垂直ステッパー）
- [ ] キーボードナビゲーション（Tab、Enter）

### テストシナリオ

1. **ハッピーパス:** すべてのステップを入力 → 正常完了
2. **バリデーションエラー:** 無効な口座番号 → エラー表示
3. **中断:** ステップ2でタブを閉じる → 再開時にデータを復元
4. **ネットワークエラー:** 送信失敗 → リトライボタンを表示

---

## 📋 例 2: ウィジェット付きカスタマイズ可能なダッシュボード

### ユーザーストーリー

> **パワーユーザー**として、**ダッシュボードをウィジェットでパーソナライズしたい**。そうすることで、**重要な情報を一目で確認できます**。

### 機能スコープ

- **ウィジェットライブラリ:** 8つの事前定義ウィジェット
- **ドラッグ＆ドロップ:** 自由な配置
- **リサイズ:** ハンドルでサイズ変更
- **永続化:** レイアウトを保存

### 利用可能なウィジェット

| ウィジェット       | サイズ        | データソース             |
| ------------------ | ------------- | ------------------------ |
| 売上チャート       | 1x1、2x1、2x2 | `/api/stats/revenue`     |
| 最近の注文         | 1x2、2x2      | `/api/orders?limit=10`   |
| タスクリスト       | 1x1、1x2      | `/api/tasks?status=open` |
| KPIタイル          | 1x1、2x1      | `/api/stats/kpis`        |
| カレンダー         | 2x2           | `/api/events`            |
| チーム活動         | 1x2           | `/api/activity`          |
| クイックアクション | 1x1           | 静的                     |
| メモ               | 1x1、1x2      | `/api/notes`             |

### グリッドシステム

```
┌──────────┬──────────┬──────────┬──────────┐
│ ウィジェット │ ウィジェット │      ウィジェット       │
│   1x1    │   1x1    │        2x1          │
├──────────┼──────────┼──────────┬──────────┤
│      ウィジェット       │ ウィジェット │ ウィジェット │
│        2x1          │   1x1    │   1x1    │
├──────────┬──────────┼──────────┴──────────┤
│ ウィジェット │ ウィジェット │      ウィジェット       │
│   1x2    │   1x2    │        2x2          │
│          │          │                     │
└──────────┴──────────┴─────────────────────┘
```

### 受け入れ基準

- [ ] プレビューカード付きウィジェットライブラリ
- [ ] 配置用ドラッグ＆ドロップ（react-grid-layoutまたはvue-grid-layout）
- [ ] コーナーハンドルでリサイズ
- [ ] 衝突検出（ウィジェットが重ならない）
- [ ] レイアウトをDBに保存（変更後500msでデバウンス）
- [ ] デフォルトレイアウトにリセット（ボタン + 確認）
- [ ] レスポンシブ: グリッドがビューポートに適応
- [ ] 各ウィジェットのローディングスケルトン

---

## 📋 例 3: アプリ内通知センター

### ユーザーストーリー

> **ユーザー**として、**すべての関連通知を一箇所で見たい**。そうすることで、**重要なことを見逃しません**。

### コンポーネントアーキテクチャ

```
┌─────────────────────────────────────────────────┐
│                    ヘッダー                       │
│  ロゴ   ナビ   ナビ   ナビ   [🔔 3]   アバター   │
└─────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │  通知               │
                    │  ドロップダウン       │
                    │  ┌───────────────┐  │
                    │  │ 新規注文       │  │
                    │  │ 2分前         │  │
                    │  ├───────────────┤  │
                    │  │ タスク完了     │  │
                    │  │ 1時間前       │  │
                    │  └───────────────┘  │
                    │  [すべて既読にする]  │
                    │  [すべて表示 →]     │
                    └─────────────────────┘
```

### データモデル

```typescript
interface Notification {
  id: string;
  type: 'order' | 'task' | 'system' | 'mention';
  title: string;
  message: string;
  link?: string;
  isRead: boolean;
  createdAt: Date;
  expiresAt?: Date;
}
```

### 受け入れ基準

- [ ] ベルアイコンにバッジ（未読カウンター、最大99+）
- [ ] 直近10件の通知付きドロップダウン
- [ ] 既読にする（個別またはすべて）
- [ ] 通知クリック → 関連ページにナビゲート
- [ ] WebSocket経由のリアルタイム更新
- [ ] データベースでの永続化
- [ ] 新しい通知時のサウンド（オプション、設定可能）
- [ ] ページネーションとフィルタリング付き「すべての通知」ページ

---

## ✅ なぜ 13 ポイントなのか？

| 基準           | 評価                             |
| -------------- | -------------------------------- |
| アーキテクチャ | 複数システムの統合               |
| 状態           | 複雑な状態管理                   |
| コンポーネント | 10以上の新規/変更ファイル        |
| 永続化         | データベース + APIエンドポイント |
| テスト         | 高いテスト工数                   |
| リスク         | エッジケースとエラーシナリオ     |
