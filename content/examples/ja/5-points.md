# 5 ストーリーポイント – 中規模の変更

> **工数:** 1〜2日
> **リスク:** 中程度
> **テスト:** ユニット、統合、E2Eテスト推奨
> **複雑さ:** 中程度

---

## 📋 例 1: 注文のCSVエクスポート

### ユーザーストーリー

> **ショップ管理者**として、**表示されているすべての注文をCSVでエクスポートしたい**。そうすることで、**Excelでデータを処理できます**。

### 背景

注文一覧は現在最大100件の注文を表示しています。新しいエクスポートボタンでこれらをCSVファイルとしてダウンロードできるようにします。アクティブなフィルタは反映される必要があります。

### 技術アーキテクチャ

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   ExportButton  │────▶│   OrderService  │────▶│   CSV-Generator │
│   (フロントエンド)   │     │   (API呼び出し)    │     │   (バックエンド)     │
└─────────────────┘     └─────────────────┘     └─────────────────┘
         │                                               │
         │◀──────────────── Blob ダウンロード ◀──────────────┘
```

### API仕様

```http
GET /api/orders/export?status=pending&from=2024-01-01
Accept: text/csv

レスポンス:
Content-Type: text/csv; charset=utf-8
Content-Disposition: attachment; filename="orders-2024-01-15.csv"
```

### CSVフォーマット

```csv
注文番号;日付;顧客;商品数;合計
ORD-2024-001;2024/01/15;山田太郎;3;¥14,999
ORD-2024-002;2024/01/15;鈴木花子;1;¥2,999
```

### 受け入れ基準

- [ ] 注文一覧の右上に「CSVでエクスポート」ボタン
- [ ] 列: 注文番号、日付、顧客、商品数、合計
- [ ] 日本語フォーマット（日付: YYYY/MM/DD、数値: 1,234.56）
- [ ] Excel互換性のためUTF-8（BOM付き）
- [ ] ファイル名: `orders-YYYY-MM-DD.csv`
- [ ] 生成中のローディングスピナー
- [ ] 10,000行超のエラーハンドリング

### テストシナリオ

1. **ハッピーパス:** 50件の注文をエクスポート → CSV正常
2. **空のエクスポート:** 注文なし → 情報メッセージを表示
3. **大量データ:** 5,000件の注文 → パフォーマンス3秒未満
4. **特殊文字:** アクセント付きの顧客名 → Excelで正常表示

---

## 📋 例 2: サーバーサイドページネーション

### ユーザーストーリー

> **ユーザー**として、**大きなリストをナビゲートしたい**。そうすることで、**ページの読み込みが速く、整理された状態を維持できます**。

### 背景

商品リストは現在5,000件以上のアイテムを一度にすべて読み込むため、読み込み時間が長くなっています。1ページあたり20件のサーバーサイドページネーションを実装する必要があります。

### API変更

```typescript
// 新しいエンドポイント
GET /api/articles?page=1&limit=20&sort=name:asc

// レスポンス
{
  "data": [...],
  "meta": {
    "total": 5432,
    "page": 1,
    "limit": 20,
    "totalPages": 272
  }
}
```

### UIコンポーネント

```
┌────────────────────────────────────────────────┐
│  ◀ 戻る   1  2  3  ...  271  272   次へ ▶      │
│             5,432件中 1-20件を表示             │
└────────────────────────────────────────────────┘
```

### 受け入れ基準

- [ ] バックエンド: `page`、`limit`、`sort` パラメータ付きエンドポイント
- [ ] フロントエンド: ページ番号付きページネーションコンポーネント
- [ ] URL同期: `?page=2` がURLに反映される
- [ ] ディープリンク: ページ5への直接アクセスが機能する
- [ ] ページ変更中のローディング状態（スケルトン）
- [ ] フィルタ変更時にページ1にジャンプ
- [ ] モバイル: 簡略化されたページネーション（前へ/次へのみ）

---

## 📋 例 3: プロフィール画像のアップロード

### ユーザーストーリー

> **登録ユーザー**として、**プロフィール画像をアップロードしたい**。そうすることで、**プロフィールがより個性的になります**。

### 受け入れ基準

- [ ] ドラッグ＆ドロップまたはファイル選択
- [ ] 許可フォーマット: JPG、PNG、WebP
- [ ] 最大サイズ: 5 MB
- [ ] アップロード前のプレビュー（トリミングオプション）
- [ ] アップロード中の進捗インジケータ
- [ ] サーバーサイド: 最大400x400pxにリサイズ
- [ ] 古い画像は自動的に削除
- [ ] フォールバック: 画像がない場合はイニシャルアバター

### エラーハンドリング

| エラー             | メッセージ                                           |
| ------------------ | ---------------------------------------------------- |
| 不正なフォーマット | 「JPG、PNG、WebPのみ許可されています」               |
| サイズ超過         | 「画像は5 MB以下にしてください」                     |
| アップロード失敗   | 「アップロードに失敗しました。再試行してください。」 |

---

## ✅ なぜ 5 ポイントなのか？

| 基準           | 評価                          |
| -------------- | ----------------------------- |
| アーキテクチャ | フロントエンド + バックエンド |
| コンポーネント | 3〜5個の新規/変更ファイル     |
| ロジック       | 中程度の複雑さ                |
| テスト         | ユニット + 統合が必要         |
| リスク         | 管理可能                      |
