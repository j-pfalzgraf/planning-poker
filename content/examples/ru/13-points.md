# 13 Story Points – Крупные изменения

> **Трудозатраты:** 3–5 дней
> **Риск:** Высокий
> **Тесты:** Требуется полное покрытие тестами
> **Сложность:** Высокая

---

## 📋 Пример 1: Многошаговый мастер онбординга

### Epic

> Как **новый клиент** я хочу **быть проведённым через процесс настройки**, чтобы **как можно быстрее начать продуктивно использовать систему**.

### Предыстория

Новым клиентам в настоящее время приходится искать все настройки вручную. 4-шаговый мастер должен провести их через самые важные шаги и сократить время до получения ценности.

### Поток мастера

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Шаг 1     │───▶│   Шаг 2     │───▶│   Шаг 3     │───▶│   Шаг 4     │
│  Компания   │    │  Контакт    │    │   Оплата    │    │   Итог      │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │
      ▼                  ▼                  ▼                  ▼
   Валидация         Валидация         Валидация          Отправка
   сохранение        сохранение        сохранение         всех данных
```

### Детали шагов

| Шаг                | Поля                       | Валидация                  |
| ------------------ | -------------------------- | -------------------------- |
| 1. Данные компании | Название, Адрес, ИНН       | Обязательные, формат ИНН   |
| 2. Контактное лицо | Имя, Email, Телефон        | Формат email, обязательные |
| 3. Способ оплаты   | Карта или счёт             | Проверка номера            |
| 4. Итог            | Все данные (только чтение) | Подтверждение              |

### Технические компоненты

```typescript
// Управление состоянием
interface OnboardingState {
  currentStep: 1 | 2 | 3 | 4;
  company: CompanyData | null;
  contact: ContactData | null;
  payment: PaymentData | null;
  isDirty: boolean;
  errors: Record<string, string[]>;
}

// Промежуточное хранение
const STORAGE_KEY = 'onboarding_draft';
localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
```

### Критерии приёмки

- [ ] Индикатор прогресса показывает текущий шаг (1/4, 2/4, ...)
- [ ] Валидация на каждом шаге при нажатии Далее
- [ ] Навигация назад без потери данных
- [ ] Автосохранение в LocalStorage каждые 30с и при потере фокуса
- [ ] Предупреждение при уходе со страницы с несохранёнными данными
- [ ] Финальный итог со ссылками для редактирования каждого шага
- [ ] Обработка ошибок при отправке (логика повтора)
- [ ] Оптимизировано для мобильных (вертикальный stepper)
- [ ] Навигация клавиатурой (Tab, Enter)

### Тестовые сценарии

1. **Happy Path:** Заполнить все шаги → Успешно завершено
2. **Ошибка валидации:** Неверный номер счёта → Показать ошибку
3. **Прерывание:** Закрыть вкладку на шаге 2 → Восстановить данные при повторном открытии
4. **Ошибка сети:** Отправка не удалась → Показать кнопку повтора

---

## 📋 Пример 2: Настраиваемый дашборд с виджетами

### Пользовательская история

> Как **продвинутый пользователь** я хочу **персонализировать свой дашборд виджетами**, чтобы **видеть важную для меня информацию с первого взгляда**.

### Объём функции

- **Библиотека виджетов:** 8 предопределённых виджетов
- **Drag & Drop:** Свободное позиционирование
- **Изменение размера:** Изменение размера через ручку
- **Сохранение:** Макет сохраняется

### Доступные виджеты

| Виджет             | Размеры       | Источник данных          |
| ------------------ | ------------- | ------------------------ |
| График выручки     | 1x1, 2x1, 2x2 | `/api/stats/revenue`     |
| Последние заказы   | 1x2, 2x2      | `/api/orders?limit=10`   |
| Список задач       | 1x1, 1x2      | `/api/tasks?status=open` |
| KPI-плитки         | 1x1, 2x1      | `/api/stats/kpis`        |
| Календарь          | 2x2           | `/api/events`            |
| Активность команды | 1x2           | `/api/activity`          |
| Быстрые действия   | 1x1           | static                   |
| Заметки            | 1x1, 1x2      | `/api/notes`             |

### Система сетки

```
┌──────────┬──────────┬──────────┬──────────┐
│  Виджет  │  Виджет  │       Виджет        │
│   1x1    │   1x1    │        2x1          │
├──────────┼──────────┼──────────┬──────────┤
│       Виджет        │  Виджет  │  Виджет  │
│        2x1          │   1x1    │   1x1    │
├──────────┬──────────┼──────────┴──────────┤
│  Виджет  │  Виджет  │       Виджет        │
│   1x2    │   1x2    │        2x2          │
│          │          │                     │
└──────────┴──────────┴─────────────────────┘
```

### Критерии приёмки

- [ ] Библиотека виджетов с превью-карточками
- [ ] Drag & drop для позиционирования (react-grid-layout или vue-grid-layout)
- [ ] Изменение размера через угловые ручки
- [ ] Обнаружение коллизий (виджеты не перекрываются)
- [ ] Макет сохраняется в БД (debounced, 500мс после изменения)
- [ ] Сброс к макету по умолчанию (кнопка + подтверждение)
- [ ] Адаптивность: Сетка подстраивается под viewport
- [ ] Loading skeleton для каждого виджета

---

## 📋 Пример 3: Центр уведомлений в приложении

### Пользовательская история

> Как **пользователь** я хочу **видеть все важные уведомления в одном месте**, чтобы **ничего не пропустить**.

### Архитектура компонентов

```
┌─────────────────────────────────────────────────┐
│                    Header                        │
│  Лого   Nav   Nav   Nav   [🔔 3]   Аватар       │
└─────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │  Выпадающий список  │
                    │  уведомлений        │
                    │  ┌───────────────┐  │
                    │  │ Новый заказ   │  │
                    │  │ 2 мин назад   │  │
                    │  ├───────────────┤  │
                    │  │ Задача готова │  │
                    │  │ 1 час назад   │  │
                    │  └───────────────┘  │
                    │  [Отметить всё как │
                    │   прочитанное]      │
                    │  [Все →]            │
                    └─────────────────────┘
```

### Модель данных

```typescript
interface Notification {
  id: string;
  type: 'order' | 'task' | 'system' | 'mention';
  title: string;
  message: string;
  link?: string;
  isRead: boolean;
  createdAt: Date;
  expiresAt?: Date;
}
```

### Критерии приёмки

- [ ] Иконка колокольчика с бейджем (счётчик непрочитанных, макс. 99+)
- [ ] Выпадающий список с последними 10 уведомлениями
- [ ] Отметить как прочитанное (индивидуально или все)
- [ ] Клик по уведомлению → переход на соответствующую страницу
- [ ] Обновления в реальном времени через WebSocket
- [ ] Сохранение в базе данных
- [ ] Звук при новом уведомлении (опционально, настраиваемо)
- [ ] Страница "Все уведомления" с пагинацией и фильтрацией

---

## ✅ Почему 13 баллов?

| Критерий    | Оценка                               |
| ----------- | ------------------------------------ |
| Архитектура | Интегрировано несколько систем       |
| Состояние   | Сложное управление состоянием        |
| Компоненты  | 10+ новых/изменённых файлов          |
| Сохранение  | База данных + API endpoints          |
| Тесты       | Высокие трудозатраты на тестирование |
| Риск        | Граничные случаи и сценарии ошибок   |
