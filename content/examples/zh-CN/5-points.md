# 5 故事点 – 中型变更

> **工作量：** 1-2 天
> **风险：** 中等
> **测试：** 建议单元测试、集成测试和端到端测试
> **复杂度：** 中等

---

## 📋 示例 1：订单 CSV 导出

### 用户故事

> 作为**店铺管理员**，我希望**将所有显示的订单导出为 CSV**，以便**我可以在 Excel 中处理数据**。

### 背景

订单概览当前最多显示 100 个订单。新的导出按钮应将这些订单下载为 CSV 文件。应遵守当前筛选条件。

### 技术架构

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   ExportButton  │────▶│   OrderService  │────▶│   CSV-Generator │
│   (前端)        │     │   (API 调用)    │     │   (后端)        │
└─────────────────┘     └─────────────────┘     └─────────────────┘
         │                                               │
         │◀──────────────── Blob 下载 ◀──────────────────┘
```

### API 规范

```http
GET /api/orders/export?status=pending&from=2024-01-01
Accept: text/csv

响应:
Content-Type: text/csv; charset=utf-8
Content-Disposition: attachment; filename="orders-2024-01-15.csv"
```

### CSV 格式

```csv
订单号;日期;客户;商品数;总金额
ORD-2024-001;2024/01/15;张三;3;¥149.99
ORD-2024-002;2024/01/15;李四;1;¥29.99
```

### 验收标准

- [ ] 在订单概览右上角显示"导出为 CSV"按钮
- [ ] 列：订单号、日期、客户、商品数量、总金额
- [ ] 中国格式（日期：YYYY/MM/DD，数字：1,234.56）
- [ ] 使用带 BOM 的 UTF-8 以确保 Excel 兼容性
- [ ] 文件名：`orders-YYYY-MM-DD.csv`
- [ ] 生成期间显示加载动画
- [ ] 超过 10,000 行时的错误处理

### 测试场景

1. **正常流程：** 导出 50 个订单 → CSV 正确
2. **空导出：** 无订单 → 显示提示信息
3. **大数据量：** 5,000 个订单 → 性能 < 3 秒
4. **特殊字符：** 客户名包含特殊字符 → Excel 中正确显示

---

## 📋 示例 2：服务端分页

### 用户故事

> 作为**用户**，我希望**能够浏览大型列表**，以便**页面加载快速且保持整洁**。

### 背景

产品列表当前一次加载所有 5,000 多个项目，导致加载时间过长。应实现每页 20 个项目的服务端分页。

### API 变更

```typescript
// 新端点
GET /api/articles?page=1&limit=20&sort=name:asc

// 响应
{
  "data": [...],
  "meta": {
    "total": 5432,
    "page": 1,
    "limit": 20,
    "totalPages": 272
  }
}
```

### UI 组件

```
┌────────────────────────────────────────────────┐
│  « 上一页  |  1  2  3 ... 272  |  下一页 »    │
└────────────────────────────────────────────────┘
```
