# 13 故事点 – 大型变更

> **工作量：** 3-5 天
> **风险：** 高
> **测试：** 需要完整测试覆盖
> **复杂度：** 高

---

## 📋 示例 1：多步骤引导向导

### 史诗

> 作为**新客户**，我希望**通过设置流程获得指导**，以便**我可以尽快高效地使用系统**。

### 背景

新客户目前必须手动查找所有设置。一个 4 步向导应引导他们完成最重要的步骤，减少价值实现时间。

### 向导流程

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   第 1 步   │───▶│   第 2 步   │───▶│   第 3 步   │───▶│   第 4 步   │
│  公司信息   │    │  联系人     │    │  支付方式   │    │  摘要       │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │
      ▼                  ▼                  ▼                  ▼
   验证               验证               验证               提交
   保存               保存               保存               所有数据
```

### 步骤详情

| 步骤        | 字段             | 验证           |
| ----------- | ---------------- | -------------- |
| 1. 公司信息 | 名称、地址、税号 | 必填、税号格式 |
| 2. 联系人   | 姓名、邮箱、电话 | 邮箱格式、必填 |
| 3. 支付方式 | 银行转账或信用卡 | 账号/卡号校验  |
| 4. 摘要     | 所有数据（只读） | 确认           |

### 技术组件

```typescript
// 状态管理
interface OnboardingState {
  currentStep: 1 | 2 | 3 | 4;
  company: CompanyData | null;
  contact: ContactData | null;
  payment: PaymentData | null;
  isDirty: boolean;
  errors: Record<string, string[]>;
}

// 中间存储
const STORAGE_KEY = 'onboarding_draft';
localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
```

### 验收标准

- [ ] 进度指示器显示当前步骤（1/4、2/4...）
- [ ] 点击"下一步"时对每个步骤进行验证
- [ ] 返回导航不丢失数据
- [ ] 每 30 秒和失焦时自动保存到 LocalStorage
- [ ] 离开页面时对未保存数据显示警告
- [ ] 最终摘要带有每个步骤的编辑链接
- [ ] 提交时的错误处理（重试逻辑）
- [ ] 移动端优化（垂直步骤器）
- [ ] 键盘导航（Tab、Enter）

### 测试场景

1. **正常流程：** 填写所有步骤 → 成功完成
2. **验证错误：** 无效账号 → 显示错误
3. **中断：** 在第 2 步关闭标签页 → 重新打开时恢复数据
4. **网络错误：** 提交失败 → 显示重试按钮

---

## 📋 示例 2：可定制仪表盘与小部件

### 用户故事

> 作为**高级用户**，我希望**用小部件个性化我的仪表盘**，以便**我可以一目了然地看到对我重要的信息**。

### 功能范围

- **小部件库：** 8 个预定义小部件
- **拖放：** 自由定位
- **调整大小：** 通过手柄更改大小
- **持久化：** 布局会被保存

### 可用小部件

| 小部件   | 尺寸          | 数据源                   |
| -------- | ------------- | ------------------------ |
| 收入图表 | 1x1、2x1、2x2 | `/api/stats/revenue`     |
| 最近订单 | 1x2、2x2      | `/api/orders?limit=10`   |
| 任务列表 | 1x1、1x2      | `/api/tasks?status=open` |
